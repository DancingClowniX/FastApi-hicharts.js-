<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Title</title>

</head>
<script src="https://code.highcharts.com/10/highcharts.js"></script>
<body>
<script>

    document.addEventListener('DOMContentLoaded',function () {
        async function fetchData() {
            try {
                const response = await fetch('/data'); 
                const data = await response.json(); // Парсинг
                console.log(data);
                 console.log(data[0][1]);// Вывод данных в консоль
                
                return data
            } catch (error) {
                console.error('Ошибка при получении данных:', error);
            }
        }
 window.onload = async function () {
            const data = await fetchData(); // Получаем данные
            if (data) {
                // Инициализация графика после получения данных
                Highcharts.chart('container', {
                    title: {
                        text: 'U.S Solar Employment Growth',
                        align: 'left'
                    },
                    subtitle: {
                        text: 'By Job Category. Source: <a href="https://irecusa.org/programs/solar-jobs-census/" target="_blank">IREC</a>.',
                        align: 'left'
                    },
                    yAxis: {
                        title: {
                            text: 'Number of Employees'
                        }
                    },
                    xAxis: {
                        accessibility: {
                            rangeDescription: 'Range: 1 to 12'
                        }
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle'
                    },
                    plotOptions: {
                        series: {
                            label: {
                                connectorAllowed: false
                            },
                            pointStart: 1
                        }
                    },
                    series: [{
                        name: data[0]['filial'],
                        data: [
                            data[0][1], data[0][2],data[0][3],data[0][4],data[0][5],data[0][6],
                            data[0][7],data[0][8],data[0][9],data[0][10],data[0][11],data[0][12]
                        ]
                    }, {
                        name: data[1]['filial'],
                        data: [
                             data[1][1], data[1][2],data[1][3],data[1][4],data[1][5],data[1][6],
                            data[1][7],data[1][8],data[1][9],data[1][10],data[1][11],data[1][12]
                        ]
                    }, {
                        name: data[2]['filial'],
                        data: [
                             data[2][1], data[2][2],data[2][3],data[2][4],data[2][5],data[2][6],
                            data[2][7],data[2][8],data[2][9],data[2][10],data[2][11],data[2][12]
                        ]
                    }, {
                        name: data[3]['filial'],
                        data: [
                             data[3][1], data[3][2],data[3][3],data[3][4],data[3][5],data[3][6],
                            data[3][7],data[3][8],data[3][9],data[3][10],data[3][11],data[3][12]
                        ]
                    }, {
                        name: data[4]['filial'],
                        data: [
                             data[4][1], data[4][2],data[4][3],data[4][4],data[4][5],data[4][6],
                            data[4][7],data[4][8],data[4][9],data[4][10],data[4][11],data[4][12]
                        ]
                    },
                        {
                        name: data[5]['filial'],
                        data: [
                             data[5][1], data[5][2],data[5][3],data[5][4],data[5][5],data[5][6],
                            data[5][7],data[5][8],data[5][9],data[5][10],data[5][11],data[5][12]
                        ]
                    },
                        {
                        name: data[6]['filial'],
                        data: [
                             data[6][1], data[6][2],data[6][3],data[6][4],data[6][5],data[6][6],
                            data[6][7],data[6][8],data[6][9],data[6][10],data[6][11],data[6][12]
                        ]
                    },
                        {
                        name: data[7]['filial'],
                        data: [
                             data[7][1], data[7][2],data[7][3],data[7][4],data[7][5],data[7][6],
                            data[7][7],data[7][8],data[7][9],data[7][10],data[7][11],data[7][12]
                        ]
                    }
                    ],
                    responsive: {
                        rules: [{
                            condition: {
                                maxWidth: 500
                            },
                            chartOptions: {
                                legend: {
                                    layout: 'horizontal',
                                    align: 'center',
                                    verticalAlign: 'bottom'
                                }
                            }
                        }]
                    }
                });
            }
        };
    });
</script>

<div id="container">Graphic</div>

</body>
</html>
